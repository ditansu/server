#!groovy

WORK_NODE = ''


stage("Prepare") {

    node('master') {

        echo "Start prepare..."

        if (BRANCH_NAME == 'devops_develop') {
            WORK_NODE = 'chstage-node'
        } else if (BRANCH_NAME == 'devops_prod') {
            WORK_NODE = 'chstage-node'
        }
        echo "end prepare the Node is ${WORK_NODE}..."
        sh 'printenv'
    }
}


node(WORK_NODE){
  WORK_DIR = ''
  MYSQL_CONFIG = "/home/jenkins/ch-stage/scripts/mysql.json"

  stage("1 of 3 Checkout") {

        WORK_DIR = pwd() //"${BASE_DIR}/${WS_DIR}"
        def SCRIPTS_DIR = "${WORK_DIR}/Devops"

        //MySQL config
        def MYSQL_CONFIG = "/home/jenkins/ch-stage/scripts/mysql.json"
        def SERVER_CONFIG_DIR = "${WORK_DIR}/Config/secrets/"

        //Build config
        def VAPOR = "/usr/local/bin/vapor"
        def BUILD_PARAM = "--verbose --release"

        echo "Start checkout on node: ${WORK_NODE}"
        checkout scm
        echo "========================"
        sh 'printenv'
        echo "========================"

    }

  stage("2 of 3 Buil"){
      echo "WORK DIR ${WORK_DIR}, ${env.WORK_DIR}"
      echo "Script dir ${SCRIPTS_DIR}, ${env.SCRIPTS_DIR}"
  }

}

    //println BRANCH_NAME //"Branch ${env.BRANCH_NAME}"

/*
    if (env.GIT_BRANCH.consits("develop")){
        WORK_NODE = "chstage-node"
    } else {
        WORK_NODE = "chprod-node"
    }
*/
    //println "Work node is ${WORK_NODE}"
